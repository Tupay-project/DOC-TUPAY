<!-- errors-page.component.html -->
<article class="doc-page">
  <header class="doc-header">
    <h1>Manejo de Errores</h1>
    <p class="doc-lead">
      Aprende a identificar, manejar y resolver errores de la API de TuPay de forma efectiva.
    </p>
  </header>

  <section class="doc-section">
    <h2>Formato de Respuesta de Error</h2>
    <p>
      Todos los errores de la API siguen un formato consistente que facilita su manejo:
    </p>

    <app-code-block
      code='{
  "success": false,
  "message": "Descripción legible del error",
  "code": 400,
  "error": "Tipo de error",
  "errors": [...] // Detalles adicionales (opcional)
}'
      language="javascript"
      title="Estructura de error estándar">
    </app-code-block>

    <table class="doc-table">
      <thead>
        <tr>
          <th>Campo</th>
          <th>Tipo</th>
          <th>Descripción</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>success</code></td>
          <td>boolean</td>
          <td>Siempre <code>false</code> en errores</td>
        </tr>
        <tr>
          <td><code>message</code></td>
          <td>string</td>
          <td>Descripción detallada del error</td>
        </tr>
        <tr>
          <td><code>code</code></td>
          <td>number</td>
          <td>Código de estado HTTP</td>
        </tr>
        <tr>
          <td><code>error</code></td>
          <td>string</td>
          <td>Tipo de error (e.g., "Unauthorized")</td>
        </tr>
        <tr>
          <td><code>errors</code></td>
          <td>array</td>
          <td>Detalles adicionales (opcional)</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section class="doc-section">
    <h2>Códigos de Error HTTP</h2>
    <p>
      La API utiliza códigos de estado HTTP estándar para indicar el éxito o fracaso de una petición.
    </p>

    <div class="error-categories">
      <div class="error-category">
        <div class="error-category__badge error-category__badge--success">2xx</div>
        <h4>Éxito</h4>
        <p>La petición fue procesada correctamente</p>
      </div>
      <div class="error-category">
        <div class="error-category__badge error-category__badge--client">4xx</div>
        <h4>Error del Cliente</h4>
        <p>Hay un problema con la petición enviada</p>
      </div>
      <div class="error-category">
        <div class="error-category__badge error-category__badge--server">5xx</div>
        <h4>Error del Servidor</h4>
        <p>Problema en el servidor de TuPay</p>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Errores Comunes</h2>
    
    <div class="error-list">
      <div *ngFor="let error of errorCodes" class="error-item" [class]="getErrorClass(error.code)">
        <div class="error-item__header">
          <div class="error-item__badge">{{ error.code }}</div>
          <div class="error-item__title">
            <h3>{{ error.name }}</h3>
            <p>{{ error.description }}</p>
          </div>
        </div>

        <div class="error-item__body">
          <div class="error-item__section">
            <h4>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
              Causas Comunes
            </h4>
            <ul>
              <li *ngFor="let cause of error.causes">{{ cause }}</li>
            </ul>
          </div>

          <div class="error-item__section">
            <h4>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
              </svg>
              Solución
            </h4>
            <p>{{ error.solution }}</p>
          </div>

          <div class="error-item__example" *ngIf="error.example">
            <h4>Ejemplo de Respuesta</h4>
            <app-code-block
              [code]="error.example"
              language="javascript">
            </app-code-block>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Estrategias de Reintento</h2>
    <p>
      Para errores temporales (429, 5xx), implementa una estrategia de reintento con backoff exponencial:
    </p>

    <app-code-block
      [code]="retryExample"
      language="javascript"
      title="Implementación de reintentos con backoff exponencial">
    </app-code-block>

    <div class="info-box info-box--info">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      <div>
        <h4>Headers de Rate Limiting</h4>
        <p>
          Cuando recibes un error 429, la respuesta incluye el header <code>Retry-After</code> 
          que indica cuántos segundos debes esperar antes de reintentar.
        </p>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Buenas Prácticas</h2>
    
    <div class="best-practices-grid">
      <div class="practice-item">
        <div class="practice-item__icon practice-item__icon--blue">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
          </svg>
        </div>
        <h4>Logging Completo</h4>
        <p>
          Registra todos los errores con el <code>requestId</code> para facilitar 
          el debugging y soporte.
        </p>
      </div>

      <div class="practice-item">
        <div class="practice-item__icon practice-item__icon--cyan">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        </div>
        <h4>Mensajes Claros</h4>
        <p>
          Muestra mensajes de error claros a tus usuarios, pero no expongas 
          detalles técnicos sensibles.
        </p>
      </div>

      <div class="practice-item">
        <div class="practice-item__icon practice-item__icon--green">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <h4>Validación Previa</h4>
        <p>
          Valida los datos en tu frontend antes de enviarlos a la API para 
          reducir errores 400.
        </p>
      </div>

      <div class="practice-item">
        <div class="practice-item__icon practice-item__icon--yellow">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
        </div>
        <h4>Timeouts</h4>
        <p>
          Configura timeouts apropiados en tus peticiones (recomendado: 30 segundos).
        </p>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Monitoreo y Alertas</h2>
    <p>
      Configura alertas para detectar problemas antes de que afecten a tus usuarios:
    </p>

    <ul>
      <li>Tasa de errores 4xx superior al 5%</li>
      <li>Cualquier error 5xx</li>
      <li>Latencia superior a 5 segundos</li>
      <li>Errores 429 (rate limiting)</li>
    </ul>

    <div class="info-box info-box--success">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <div>
        <h4>Status Page</h4>
        <p>
          Consulta el estado de la API en tiempo real en 
          <a href="https://status.tupay.finance" target="_blank" rel="noopener">
            status.tupay.finance
          </a>
        </p>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Soporte</h2>
    <p>
      Si encuentras un error que no puedes resolver, contacta a nuestro equipo de soporte:
    </p>

    <div class="support-channels">
      <div class="support-channel">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
        <div>
          <h4>Email</h4>
          <a href="/cdn-cgi/l/email-protection#167f78707956626366776f38707f7877787573"><span class="__cf_email__" data-cfemail="51383f373e1125242130287f37383f303f3234">[email&#160;protected]</span></a>
        </div>
      </div>

      <div class="support-channel">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
        </svg>
        <div>
          <h4>Chat en Vivo</h4>
          <p>Lunes a Viernes, 9am - 6pm</p>
        </div>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Próximos Pasos</h2>
    <div class="next-steps">
      <a routerLink="/gateway/introduction" class="next-step-card">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
        <div>
          <h4>Introducción</h4>
          <p>Vuelve a la guía de inicio</p>
        </div>
      </a>

      <a routerLink="/gtm/api" class="next-step-card">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="16 18 22 12 16 6"></polyline>
          <polyline points="8 6 2 12 8 18"></polyline>
        </svg>
        <div>
          <h4>API Reference</h4>
          <p>Explora los endpoints de la API</p>
        </div>
      </a>
    </div>
  </section>
</article>
      