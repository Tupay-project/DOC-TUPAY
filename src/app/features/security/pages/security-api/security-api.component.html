<article class="doc-page" role="main" aria-labelledby="api-title">
  <header class="doc-header">
    <div class="doc-header__badge">
      <span class="version-badge">v1</span>
      <span class="status-badge status-badge--stable">REST API</span>
    </div>
    <h1 id="api-title">Referencia de API</h1>
    <p class="doc-lead">
      Documentacion completa de los endpoints de Shield Antifraude para validar transacciones,
      notificar resultados y gestionar verificaciones.
    </p>
  </header>

  <!-- Base URLs -->
  <section class="doc-section" aria-labelledby="base-urls">
    <h2 id="base-urls">Base URLs</h2>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Ambiente</th>
          <th scope="col">URL</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="env-badge env-badge--prod">Produccion</span></td>
          <td><code>https://shield.tupay.finance/api/v1</code></td>
        </tr>
        <tr>
          <td><span class="env-badge env-badge--sandbox">Sandbox</span></td>
          <td><code>https://shield-sandbox.tupay.finance/api/v1</code></td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Autenticacion -->
  <section class="doc-section" aria-labelledby="auth">
    <h2 id="auth">Autenticacion</h2>
    <p>Todas las peticiones deben incluir el header <code>Api-Key</code>:</p>

    <app-code-block
      [code]="curlExample"
      language="curl"
      title="Ejemplo de autenticacion">
    </app-code-block>

    <div class="info-box info-box--warning">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
      <div>
        <h4>Seguridad de API Keys</h4>
        <p>
          Nunca expongas tu API Key en codigo del lado del cliente. Las llamadas a Shield
          deben realizarse exclusivamente desde tu backend.
        </p>
      </div>
    </div>
  </section>

  <!-- POST /validate -->
  <section class="doc-section" aria-labelledby="validate">
    <h2 id="validate">POST /validate</h2>
    <p>Valida una transaccion y retorna el score de riesgo con la accion recomendada.</p>

    <h3>Request</h3>
    <app-code-block
      [code]="validateRequest"
      language="json"
      title="Body">
    </app-code-block>

    <h3>Parametros del Request</h3>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Campo</th>
          <th scope="col">Tipo</th>
          <th scope="col">Requerido</th>
          <th scope="col">Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>transaction.reference</code></td>
          <td>string</td>
          <td>Si</td>
          <td>Referencia unica de la transaccion</td>
        </tr>
        <tr>
          <td><code>transaction.amount</code></td>
          <td>number</td>
          <td>Si</td>
          <td>Monto en centavos (15000000 = Q150,000.00)</td>
        </tr>
        <tr>
          <td><code>transaction.currency</code></td>
          <td>string</td>
          <td>Si</td>
          <td>Codigo de moneda (GTQ, DOP, USD)</td>
        </tr>
        <tr>
          <td><code>payer.document</code></td>
          <td>string</td>
          <td>Si</td>
          <td>Numero de documento de identidad</td>
        </tr>
        <tr>
          <td><code>payer.documentType</code></td>
          <td>string</td>
          <td>Si</td>
          <td>Tipo de documento (DPI, CED, PASSPORT)</td>
        </tr>
        <tr>
          <td><code>payer.email</code></td>
          <td>string</td>
          <td>Si</td>
          <td>Email del pagador</td>
        </tr>
        <tr>
          <td><code>device.ipAddress</code></td>
          <td>string</td>
          <td>Si</td>
          <td>IP del cliente (IPv4 o IPv6)</td>
        </tr>
        <tr>
          <td><code>device.fingerprint</code></td>
          <td>string</td>
          <td>No</td>
          <td>Device fingerprint del SDK</td>
        </tr>
        <tr>
          <td><code>payment.instrument.card</code></td>
          <td>object</td>
          <td>No</td>
          <td>Datos de tarjeta (primeros 6 y ultimos 4 digitos)</td>
        </tr>
      </tbody>
    </table>

    <h3>Responses</h3>

    <div class="response-tabs">
      <div class="response-tab">
        <div class="response-tab__header response-tab__header--allow">
          <span class="response-tab__action">ALLOW</span>
          <span class="response-tab__code">200 OK</span>
        </div>
        <app-code-block
          [code]="validateResponseAllow"
          language="json"
          title="Score 0-20">
        </app-code-block>
      </div>

      <div class="response-tab">
        <div class="response-tab__header response-tab__header--stepup">
          <span class="response-tab__action">STEP_UP</span>
          <span class="response-tab__code">200 OK</span>
        </div>
        <app-code-block
          [code]="validateResponseStepup"
          language="json"
          title="Score 21-50">
        </app-code-block>
      </div>

      <div class="response-tab">
        <div class="response-tab__header response-tab__header--hold">
          <span class="response-tab__action">HOLD</span>
          <span class="response-tab__code">200 OK</span>
        </div>
        <app-code-block
          [code]="validateResponseHold"
          language="json"
          title="Score 51-80">
        </app-code-block>
      </div>

      <div class="response-tab">
        <div class="response-tab__header response-tab__header--block">
          <span class="response-tab__action">BLOCK</span>
          <span class="response-tab__code">200 OK</span>
        </div>
        <app-code-block
          [code]="validateResponseBlock"
          language="json"
          title="Score 81-100">
        </app-code-block>
      </div>
    </div>
  </section>

  <!-- POST /notify -->
  <section class="doc-section" aria-labelledby="notify">
    <h2 id="notify">POST /notify</h2>
    <p>
      Notifica el resultado final de una transaccion. Esto permite al modelo ML aprender
      y mejorar su precision.
    </p>

    <h3>Request</h3>
    <app-code-block
      [code]="notifyRequest"
      language="json"
      title="Body">
    </app-code-block>

    <h3>Estados de Transaccion</h3>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Estado</th>
          <th scope="col">Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>approved</code></td>
          <td>Transaccion aprobada y completada exitosamente</td>
        </tr>
        <tr>
          <td><code>declined</code></td>
          <td>Transaccion rechazada por el procesador</td>
        </tr>
        <tr>
          <td><code>fraud</code></td>
          <td>Fraude confirmado (chargeback o reporte)</td>
        </tr>
        <tr>
          <td><code>cancelled</code></td>
          <td>Transaccion cancelada por el usuario</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- POST /verify -->
  <section class="doc-section" aria-labelledby="verify">
    <h2 id="verify">POST /verify</h2>
    <p>
      Verifica el codigo OTP o resultado biometrico para transacciones con accion STEP_UP.
    </p>

    <h3>Request</h3>
    <app-code-block
      [code]="verifyRequest"
      language="json"
      title="Body">
    </app-code-block>

    <h3>Metodos de Verificacion</h3>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Metodo</th>
          <th scope="col">Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>OTP_SMS</code></td>
          <td>Codigo de 6 digitos enviado por SMS</td>
        </tr>
        <tr>
          <td><code>OTP_EMAIL</code></td>
          <td>Codigo de 6 digitos enviado por email</td>
        </tr>
        <tr>
          <td><code>BIOMETRIC</code></td>
          <td>Resultado de verificacion biometrica</td>
        </tr>
        <tr>
          <td><code>SECURITY_QUESTIONS</code></td>
          <td>Respuestas a preguntas de seguridad</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- GET /transactions/{id} -->
  <section class="doc-section" aria-labelledby="get-transaction">
    <h2 id="get-transaction">GET /transactions/&#123;id&#125;</h2>
    <p>Consulta el detalle de una validacion previa por su ID.</p>

    <h3>Parametros de Ruta</h3>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Parametro</th>
          <th scope="col">Tipo</th>
          <th scope="col">Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>id</code></td>
          <td>string</td>
          <td>ID de validacion retornado por POST /validate</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Codigos de Error -->
  <section class="doc-section" aria-labelledby="errors">
    <h2 id="errors">Codigos de Error</h2>

    <h3>Codigos HTTP</h3>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Codigo</th>
          <th scope="col">Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>200</code></td>
          <td>Solicitud exitosa</td>
        </tr>
        <tr>
          <td><code>400</code></td>
          <td>Bad Request - Parametros invalidos</td>
        </tr>
        <tr>
          <td><code>401</code></td>
          <td>Unauthorized - API Key invalida</td>
        </tr>
        <tr>
          <td><code>403</code></td>
          <td>Forbidden - Sin permisos para este recurso</td>
        </tr>
        <tr>
          <td><code>404</code></td>
          <td>Not Found - Recurso no encontrado</td>
        </tr>
        <tr>
          <td><code>422</code></td>
          <td>Unprocessable Entity - Error de validacion</td>
        </tr>
        <tr>
          <td><code>429</code></td>
          <td>Too Many Requests - Rate limit excedido</td>
        </tr>
        <tr>
          <td><code>500</code></td>
          <td>Internal Server Error</td>
        </tr>
      </tbody>
    </table>

    <h3>Codigos de Razon</h3>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Codigo</th>
          <th scope="col">Razon</th>
          <th scope="col">Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>00</code></td>
          <td>OK</td>
          <td>Transaccion procesada exitosamente</td>
        </tr>
        <tr>
          <td><code>01</code></td>
          <td>VALIDATION_ERROR</td>
          <td>Error en validacion de datos</td>
        </tr>
        <tr>
          <td><code>02</code></td>
          <td>INVALID_CARD</td>
          <td>Tarjeta invalida o expirada</td>
        </tr>
        <tr>
          <td><code>03</code></td>
          <td>INSUFFICIENT_DATA</td>
          <td>Datos insuficientes para analisis</td>
        </tr>
        <tr>
          <td><code>10</code></td>
          <td>HIGH_RISK</td>
          <td>Rechazado por alto riesgo</td>
        </tr>
        <tr>
          <td><code>11</code></td>
          <td>BLACKLIST</td>
          <td>Usuario/tarjeta en lista negra</td>
        </tr>
        <tr>
          <td><code>12</code></td>
          <td>VELOCITY</td>
          <td>Limite de velocidad excedido</td>
        </tr>
        <tr>
          <td><code>20</code></td>
          <td>MANUAL_REVIEW</td>
          <td>En cola para revision manual</td>
        </tr>
        <tr>
          <td><code>21</code></td>
          <td>STEP_UP_REQUIRED</td>
          <td>Requiere verificacion adicional</td>
        </tr>
        <tr>
          <td><code>30</code></td>
          <td>TIMEOUT</td>
          <td>Timeout en servicio externo</td>
        </tr>
        <tr>
          <td><code>99</code></td>
          <td>INTERNAL_ERROR</td>
          <td>Error interno del sistema</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Tarjetas de Prueba -->
  <section class="doc-section" aria-labelledby="test-cards">
    <h2 id="test-cards">Tarjetas de Prueba</h2>
    <p>Para el ambiente Sandbox, utiliza las siguientes tarjetas:</p>

    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Numero</th>
          <th scope="col">Comportamiento</th>
          <th scope="col">Score</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>4111 1111 1111 1111</code></td>
          <td><span class="action-badge action-badge--allow">ALLOW</span> Bajo riesgo</td>
          <td>10</td>
        </tr>
        <tr>
          <td><code>4222 2222 2222 2222</code></td>
          <td><span class="action-badge action-badge--stepup">STEP_UP</span> Riesgo medio</td>
          <td>35</td>
        </tr>
        <tr>
          <td><code>4333 3333 3333 3333</code></td>
          <td><span class="action-badge action-badge--hold">HOLD</span> Riesgo alto</td>
          <td>65</td>
        </tr>
        <tr>
          <td><code>4444 4444 4444 4444</code></td>
          <td><span class="action-badge action-badge--block">BLOCK</span> Riesgo critico</td>
          <td>95</td>
        </tr>
        <tr>
          <td><code>4000 0000 0000 0002</code></td>
          <td><span class="action-badge action-badge--block">BLOCK</span> Lista negra</td>
          <td>100</td>
        </tr>
      </tbody>
    </table>

    <div class="info-box info-box--info">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      <div>
        <h4>Datos de Prueba</h4>
        <p>
          En Sandbox, cualquier CVV y fecha de expiracion futura son validos.
          El codigo OTP de prueba es siempre <code>123456</code>.
        </p>
      </div>
    </div>
  </section>

  <!-- Rate Limits -->
  <section class="doc-section" aria-labelledby="rate-limits">
    <h2 id="rate-limits">Rate Limits</h2>
    <table class="doc-table" role="table">
      <thead>
        <tr>
          <th scope="col">Plan</th>
          <th scope="col">Limite</th>
          <th scope="col">Periodo</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Sandbox</td>
          <td>100 requests</td>
          <td>Por minuto</td>
        </tr>
        <tr>
          <td>Estandar</td>
          <td>500 requests</td>
          <td>Por minuto</td>
        </tr>
        <tr>
          <td>Premium</td>
          <td>1,000 requests</td>
          <td>Por minuto</td>
        </tr>
        <tr>
          <td>Enterprise</td>
          <td>Personalizado</td>
          <td>Segun contrato</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Proximos Pasos -->
  <section class="doc-section" aria-labelledby="next-steps">
    <h2 id="next-steps">Proximos Pasos</h2>
    <nav class="next-steps" aria-label="Navegacion a proximas secciones">
      <a routerLink="/security/integration" class="next-step-card">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
          <line x1="8" y1="21" x2="16" y2="21"></line>
          <line x1="12" y1="17" x2="12" y2="21"></line>
        </svg>
        <div>
          <h4>Guia de Integracion</h4>
          <p>Implementacion paso a paso</p>
        </div>
      </a>

      <a routerLink="/security/scoring" class="next-step-card">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
          <path d="M2 17l10 5 10-5"></path>
          <path d="M2 12l10 5 10-5"></path>
        </svg>
        <div>
          <h4>Sistema de Scoring</h4>
          <p>Entender como se calcula el riesgo</p>
        </div>
      </a>

      <a routerLink="/security/rules" class="next-step-card">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
        </svg>
        <div>
          <h4>Motor de Reglas</h4>
          <p>Catalogo de 150+ reglas</p>
        </div>
      </a>
    </nav>
  </section>
</article>
